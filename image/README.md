# バン・ヨンソ

# Fenrir課題プロジェクト

ユーザーが美味しいレストランをより簡単に見つけ、選べるように実装したプロジェクト、「グルグル」です。

<br>

## 開発者のGitアドレス

<table>
  <tr> 
    <td align="center"><a href="https://github.com/bys096/bys_guruguru"><img src="https://ns-union.s3.ap-northeast-2.amazonaws.com/profile/1157109.png" width="100px;" alt=""/><br /><sub><b>バン・ヨンソ</b></sub></a><br /><a href="https://hannah0su.github.io/" title="Code">🏠</a>
    </td>
  </tr>
</table>

> "昨日の自分を超え、さらに成長を追求する開発者、バン・ヨンソと申します。"

<br>

# 🔍 目次

> 1. GitHub管理戦略
> 2. プロジェクト
>    1. 概要
>    2. コンセプト
>    3. 機能
>    4. 注意深く考えた部分
>       - UI/UX
>       - SERVER
>    5. ER 図
> 3. 開発環境
>    1. フレームワーク
>    2. データベース
> 4. 苦労したこと
> 5. 使用技術
> 6. 自己評価
> 7.  アドバイスして欲しいポイント

<br>





# 1. GitHub管理戦略

## 1.1. :pushpin: Commit Convention

|   [Type]    |             説明              |                       例                       |
| :---------: | :---------------------------: | :--------------------------------------------: |
|     add     |  機能追加 :heavy_plus_sign:   |           "[add] 会員登録機能を追加"           |
|     fix     |        バグ修正 :bug:         | "[fix] フィールドにNullが入っていたバグを修正" |
|   modify    |  コード・タイポの修正 :zap:   |      "[modify] コメントAPIサービスの修正"      |
|  refactor   |  コード構造の変更 :pencil2:   |   "[refactor] 検索コードと結果コードの分離"    |
| enhancement | UIデザインの変更  (CSS) :art: |      "[enhancement] ログインボタンUI修正"      |
| Deployment  |                               |                                                |

<br>

_____



## 1.2. 作業の進行順序  

|  😆   | ⭐️ 作業前に行ったこと ⭐️                                       |
| :--: | :----------------------------------------------------------- |
|  1   | 作業内容について`Issueを作成`します。                        |
|  2   | [`Projects`](#projects-탭-활용)で該当作業のIssueを`In progress`に移動します。 |
|  3   | **作業を進行するbranchに移動**した後、作業を開始します。     |

|  👏   | `作業が完了した後!`                                          |
| :--: | :----------------------------------------------------------- |
|  1   | `pushする前に` 正常に動作するか、目に見えるエラーはないか確認します。 |
|  2   | [`git commit -m "[Type] 作業内容についての要約 #(issue番号)"`](#pushpin-commit-convention) |
|  3   | 機能開発がある程終わったらdevelop branchにMergeします。      |

<br>



## 1.3. Projectsタブの活用

![progress](./image/progress.png)

- `To do` : やること
- `In progress` : 進行中のこと
- `Done` : 完了したIssue

<br>

_______



## 1.4. Issue タブの活用

![issue](./image/issue.png)

![comment](./image/comment.png)

- 作業を開始する前に、関連するIssueを作成し、コミットは関連するIssueにタグ付けします。
- 自分が行った作業について、特異な事項が発生した場合、それを視覚的に捉えやすいようにコメントに記述しました。





## 1.5. GIt Branch管理

```
main -- develop -- add/#1   
                \_ add/#2     
```

* `main` : デプロイされるメインバージョン
* `develop` : 開発用ブランチ
* 機能開発ブランチはdevelopブランチから生成し、開発を進行します。





# 2. プロジェクト

## 2.1. 概要

- プロジェクト名: グルグル
- 意味: 美食家（グルメ）とぐるぐる巡り（グルグル）を組み合わせたプロジェクト名で、"美味しい店を求めて回る方々向けのウェブアプリケーション"という意味を含んでいます。
- サービス概要: このウェブサービスは、美食家たちが容易に美味しいレストランを見つけられるよう、位置情報に基づく検索、地図、レビューを提供します。また、これらのレビューを利用して店舗オーナーがより優れたサービスを提供できるようにすることが目指しています。



## 2.2. コンセプト

グルグルプロジェクトは、店舗情報とレビュー情報を一覧で確認できる位置情報サービスです。私は、信頼性の高いレビューを提供するために、レビューの閲覧、作成、店主認証の機能に特に力を注いで開発を進めました。

### 特徴

1. 店舗情報とレビュー情報は認証なしで簡単に閲覧できるようにしました。しかし、レビューはすべてのユーザーが各店舗に対して一つだけレビューを投稿できるようにするため、レビューの作成には認証手続きが必要です。
2. 店主は本当にその店舗の所有者であることを確認する必要があります。そのため、最初は一般会員として登録し、その後、店主として登録するプロセスを導入しました。
3. 自分の店舗情報を入力し、証明資料のファイルを添付して提出すると、管理者がこれを承認し、店主のランクに変更できます。店主のランクになると、自身の店舗に対するレビューのコメントを投稿することが可能になります。



<br>



##  2.3. 機能

1. 現在位置に基づく店舗の検索
2. 複数の条件を追加で検索可能（店名、住所、wifiの有無、駐車場の有無など）
3. 自分の位置をチェックすると、現在の基準位置に基づいて地図が変更されます。
4. 店舗検索結果のページング
5. 店主登録機能（管理者に店主としての証拠資料を提出するためのファイルをs3にアップロードします。）
6. 店主認可機能（認可時、一般会員のランクを店主に変更します。）
7. 全体会員管理機能（管理者機能として、全体の会員情報の参照、修正、削除が可能です。）
8. レビュー作成機能（すでにレビューを作成した会員は、再作成が不可能です。）
9. レビューの参照、修正、削除機能
10. レビュー作成時に星評価が可能
11. コメント作成機能（店主のみ作成可能）
12. ユーザーが意図しないURLへのアクセスを試みた場合、404エラーページに接続します。



<br>

## 2.4. 注意深く考えた部分(UX)

1. 店舗登録を申請する際、店舗情報の入力を簡略化

![ux_store_search](./image/ux_store_search.png)

![store_regi](./image/store_regi.png)

店舗登録申請時、店舗情報を検索して選択することで、入力フォームに必要な店舗情報を自動的に補完する仕組みを実装しました。

<br><br>

2. 位置情報を選択したり、店舗を検索すると、地図が該当する位置の座標に変更されます。

![store_search](./image/store_search.png)

単にテキストで検索結果を確認するだけではなく、地図を通じて詳細な位置を把握することで、ユーザーエクスペリエンスが向上すると判断し、その機能を追加しました。

<br><br>

3. 店舗の詳細ページでは、店舗検索一覧では把握できなかったさまざまな情報を含めるようにしました。

![shop_detail](./image/shop_detail.png)



店舗の種類、収容人数、営業時間、アクセスなどの情報を確認することができます。

<br><br>

4. レビューをより直感的に記入できるように、入力フォームのUIを調整しました。

![review_form](./image/review_form.png)

<br><br>

5. Q&Aタブを追加しました。

![qna](./image/qna.png)

簡単な質問や疑問については、Q&Aタブで確認できるようにし、ユーザーの疑問を解消することを目指しました。





<br>

## 2.4. 注意深く考えた部分(SERVER)



#### HTTP ステイタスコードをレスポンス

> - 作成成功：201コードのレスポンス
>
> - パッチ、取得成功：200コードのレスポンス
> - 削除成功：204コードのレスポンス

<br>

#### Exception

![error_code](./image/error_code.png)

各例外状況に応じて返却するエラーコードを定義し、例外が発生した場合、GlobalExceptionHandlerでエラーコードとメッセージを返します。

これにより、エラー状況に適した様々なコード処理をフロントエンドで実行することが可能になります。



![404](./image/404.png)

<br>

<br>

## AWS S3 & Presigned URL

![max-3060-1K5yybcjSoP_jMZUlZ_n2lw](./image/max-3060-1K5yybcjSoP_jMZUlZ_n2lw.png)

<br>

Presigned URLを使用して、ファイルのアップロードや写真のアップロードをより安全かつ効率的に保存するようにしました。

### Presigned URLとは？

プリサインドURL（Presigned URL）は、必要な時に事前に署名された一時的なURLで、これを通じてアップロードが可能になります。これにより、トラフィックが多い大容量のファイル（写真やデータなど）を、クライアントが直接S3にアップロードできます。その結果、サーバーを経由せずにS3に効率的にファイルを保存することができます。

また、特定のリソースに対して一時的にアクセス許可を与えることなので、セキュリティを高めながら必要なユーザーに対してのみリソースへのアクセスを提供することができます。

<br>



## セキュリティー

セキュリティをさらに向上させるために、有効期間の設定が可能なJWTトークン認証方式を使用しました。

1. ログイン認証に成功すると、データベースからユーザー情報と権限情報を取得し、認証オブジェクトを生成します。その後、アクセストークンとリフレッシュトークンを発行し、ユーザーに返却します。
2. その後、認証が必要なリクエストは、クライアントがアクセストークンを含めてサーバーにリクエストを送信し、サーバーはそのリクエストのヘッダーに含まれるアクセストークンを検証し、有効なトークンであるかを確認します。

セッションポリシーとしては、トークンの有効期限が切れるとログアウトされるように処理しました。

今後は、OAuth 2.0を利用し、Googleなどのサードパーティに認証および承認を委ねることで、セキュリティをさらに強化する予定です。





## Soft Delete

データベースからデータを削除する場合、関連する行をどのように削除するかには大きく2つの方法があります。データを直接データベースから削除するハードデリート（Hard Delete）と、実際には削除されなかったように見せるソフトデリート（Soft Delete）です。多くの関連性があるデータを削除しようとする場合、ハードデリートは、Cascadeオプションを使用できますが、私はソフトデリートの方法を採用しました。 Cascadeオプションは開発を非常に簡単にしてくれるオプションですが、予期しない動作を引き起こす可能性が非常に高く、企業にとってデータは財産そのものであるため、リスク管理のために実務ではソフトデリートの方法を多く採用していると言われているからです。

![soft_delete](./image/soft_delete.png)

SQLの削除操作が発生すると、該当の行は実際にはデータが削除されず、代わりにdeletedカラムの値がtrueに変更されます。そして、@Whereアノテーションを設定して、deletedがtrueである行は以降の検索クエリで発見されないようにしました。

<br>

<br>

## スプリングベースのビジネスロジック構造設計

- Controller: ユーザーからのリクエストを受け取り、ビジネスロジックを呼び出して処理した後、レスポンスを返す役割を担当します。
- Service: ビジネスロジックを実行する核心的な役割を担当します。
- Repository: データベースとの相互作用を担当し、データの永続性を管理します。
- Entity: データベースのテーブルをJavaオブジェクトで表現したもので、ビジネスロジックとデータベース間のマッピングを担当します。
- DTO: データ転送オブジェクトとして、クライアントとサーバ間でデータを送受信する際に使用されます。
- Mapper: DTOとEntity間の変換を担当します。DTOをEntityに変換したり、EntityをDTOに変換する役割を果たします。
- Exception: 例外状況を処理する役割を担当します。例外が発生したときに適切なレスポンスを返し、例外を処理するロジックを含みます。



<br>

## ドメイン型パッケージ構造の使用

大規模なプロジェクトになればなるほど、一つのパッケージに多くのクラスファイルが集中し、可読性が低下するという欠点があります。

これを考慮に入れて、ドメイン型のパッケージ構造を採用することで、拡張性および大規模プロジェクトへの対応を行いました。



<br>



## Restful API

#### ![restful_api](./image/restful_api.png)

HTTPメソッドの種類に応じて、RESTfulな方式でControllerの処理を行いました。

- 作成：POSTメソッド
- 削除：DELETEメソッド
- 更新：PATCHメソッドまたはPUTメソッド
- 取得：GETメソッド のように、各メソッドに対応する操作をController内で処理するようにしました。



<br>

## 2.5. テーブル定義(ER 図)

![erd](./image/erd.png)





# 3. 開発環境

## 3.1. フレームワーク

1. Front
   - Vue.js  `v2`
2. Back
   - Spring Boot　`v2.7.12`



## 3.2. データベース

1. MariaDB `v11.0.2`





## 3.3. ライブラリ

1. Vuetify `v2.6.15`
2. BootStrap `v5.3.0`
3. Google Map
4. VueX  `v3.6.2`

<br>

## 開発環境

OS: Mac

IDE: Visual Studio Code, InteliJ

Java JDK: `v17`



<br>

------





# 苦労したこと

1. 提出の最終日に、Vue.jsで作業した内容をビルドしてデプロイしましたが、CORSエラーや位置情報の取得エラーが発生しました。

   ### 原因

   1. Geolocation APIは、機密性の高い位置情報を取得するため、ポリシー上、ローカル環境以外ではHTTPでは動作しないためです。
   2. 以前のVue CLIの開発環境では、vue.config.jsでプロキシの設定を行っていましたが、ビルドおよびデプロイした場合にはこの設定が機能しませんでした。

   ### 解決策

   1. AWSでALB（Application Load Balancer）にSSLセキュリティ証明書を適用し、HTTPプロトコルからHTTPSに切り替えます。
   2. デプロイサーバーでリバースプロキシの設定を追加します。









## 使用技術（Skill）



<img src="https://img.shields.io/badge/vue.js-green?style=for-the-badge&logo=vue.js&logoColor=white">

<img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black">

<img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&logo=html5&logoColor=white">

<img src="https://img.shields.io/badge/css-1572B6?style=for-the-badge&logo=css3&logoColor=white">

<img src="https://img.shields.io/badge/bootstrap-7952B3?style=for-the-badge&logo=bootstrap&logoColor=white">

<img src="https://img.shields.io/badge/vuetify-blue?style=for-the-badge&logo=vuetify&logoColor=white">

<img src="https://img.shields.io/badge/AWS-white?style=for-the-badge&logo=Amazon&logoColor=orange">

<img src="https://img.shields.io/badge/mariadb-9cf?style=for-the-badge&logo=mariadb&logoColor=white">

<img src="https://img.shields.io/badge/spring-brightgreen?style=for-the-badge&logo=spring&logoColor=white">

<img src="https://img.shields.io/badge/QueryDsl-important?style=for-the-badge&logo=Q&logoColor=white">

<img src="https://img.shields.io/badge/JWT-critical?style=for-the-badge&logo=JWT&logoColor=white">

<br>



# 6. 自己評価

最初に考えていた企画は、APIが提供する機能に加えて、PythonのSeleniumを使用して多くのデータをスクレイピングし、それを処理するサーバーを実装して、さらに多くの機能を提供することでした。しかし、時間と経験の不足のため、開発期間内に実装することができませんでした。その点が残念でした。それ以外の機能は自分が考えた内容をほぼ開発を終えました。

<br>

今の完成度に甘えるのではなく、より高いプロジェクトして仕上げたいと思いました。大学の最後の夏休みを使い、より多くのデータを取り扱い、アルゴリズムを活用したウェブサイトにアップグレードすることで、データ収集やチューニングのスキルを向上させたいと考えています。

<br>

# 7. 助言してほしい点

データ処理のロジックにおいて、不思議な点や非効率なコードはないか、気になります。