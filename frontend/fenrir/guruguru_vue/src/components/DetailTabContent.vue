<template>
  <div class="tab-content mb-5">
    <div class="tab-pane fade" id="tab-news" role="tabpanel">
      <ul class="list-unstyled accordion accordion-flush" id="qa-accordion">
        <li class="accordion-item">
          <h3 class="accordion-header" id="flush-headingOne">
            <button class="
                      accordion-button
                      btn-outline-warning
                      collapsed
                      fs-lg-sm fs-mobile-4
                    " type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
              <span class="
                        bg-warning
                        text-dark
                        font-baloo-tamma
                        fs-sm
                        fw-bolder
                        text-center
                        rounded
                        me-3
                        lh-lg
                        letter-spacing-7
                      ">
                Q1
              </span>
              予約は必要ですか？予約の方法はありますか？
            </button>
          </h3>
          <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#qa-accordion">
            <p class="
                      accordion-body
                      mb-0
                      fs-lg-sm fs-mobile-4
                      lh-lg
                      text-secondary
                    ">
              一部の場合、予約が必要な場合があります。お電話での予約やオンライン予約システムを利用して予約していただけます。
            </p>
          </div>
        </li>
        <li class="accordion-item">
          <h3 class="accordion-header" id="flush-headingTwo">
            <button class="
                      accordion-button
                      btn-outline-warning
                      collapsed
                      fs-lg-sm fs-mobile-4
                    " type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
              <span class="
                        bg-warning
                        text-dark
                        font-baloo-tamma
                        fw-bolder
                        text-center
                        rounded
                        fs-sm
                        me-3
                        lh-lg
                        letter-spacing-7
                      ">
                Q2
              </span>
              レストランの営業時間はどのようになっていますか？
            </button>
          </h3>
          <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo" data-bs-parent="#qa-accordion">
            <p class="
                      accordion-body
                      mb-0
                      pe-3
                      fs-lg-sm fs-mobile-4
                      lh-lg
                      text-secondary
                    ">
              当店は[営業時間]に開店します。平日と週末では営業時間が異なる場合があるため、正確な営業時間については当店のウェブサイトやお電話でお問い合わせください。
            </p>
          </div>
        </li>
        <li class="accordion-item">
          <h3 class="accordion-header" id="flush-headingThree">
            <button class="
                      accordion-button
                      btn-outline-warning
                      collapsed
                      fs-lg-sm fs-mobile-4
                    " type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
              <span class="
                        bg-warning
                        text-dark
                        font-baloo-tamma
                        fw-bolder
                        text-center
                        rounded
                        fs-sm
                        me-3
                        lh-lg
                        letter-spacing-7
                      ">
                Q3
              </span>
              子供連れでの訪問は歓迎されますか？キッズメニューはありますか？
            </button>
          </h3>
          <div id="flush-collapseThree" class="accordion-collapse collapse" aria-labelledby="flush-headingThree" data-bs-parent="#qa-accordion">
            <p class="
                      accordion-body
                      mb-0
                      pe-3
                      fs-lg-sm fs-mobile-4
                      lh-lg
                      text-secondary
                    ">
              当店では子供連れのお客様も歓迎しています。キッズメニューもご用意しており、お子様が楽しんで食事を楽しめるように心掛けています。
            </p>
          </div>
        </li>
        <li class="accordion-item">
          <h3 class="accordion-header" id="flush-headingFour">
            <button class="
                      accordion-button
                      btn-outline-warning
                      collapsed
                      fs-lg-sm fs-mobile-4
                    " type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseFour" aria-expanded="false" aria-controls="flush-collapseFour">
              <span class="
                        bg-warning
                        text-dark
                        font-baloo-tamma
                        fw-bolder
                        text-center
                        rounded
                        fs-sm
                        me-3
                        lh-lg
                        letter-spacing-7
                      ">
                Q4
              </span>
              レストランの予約キャンセルポリシーはありますか？
            </button>
          </h3>
          <div id="flush-collapseFour" class="accordion-collapse collapse" aria-labelledby="flush-headingFour" data-bs-parent="#qa-accordion">
            <p class="
                      accordion-body
                      mb-0
                      pe-3
                      fs-lg-sm fs-mobile-4
                      lh-lg
                      text-secondary
                    ">
            当店の予約キャンセルポリシーについては、事前にお電話またはウェブサイトでご確認ください。一般的に、直前のキャンセルや予約の変更には料金が発生する場合があります。            </p>
          </div>
        </li>
        <li class="accordion-item">
          <h3 class="accordion-header" id="flush-headingFive">
            <button class="
                      accordion-button
                      btn-outline-warning
                      collapsed
                      fs-lg-sm fs-mobile-4
                    " type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseFive" aria-expanded="false" aria-controls="flush-collapseFive">
              <span class="
                        bg-warning
                        text-dark
                        font-baloo-tamma
                        fw-bolder
                        text-center
                        rounded
                        fs-sm
                        me-3
                        lh-lg
                        letter-spacing-7
                      ">
                Q5
              </span>
              レストランのシェフはどのような経歴を持っていますか？
            </button>
          </h3>
          <div id="flush-collapseFive" class="accordion-collapse collapse" aria-labelledby="flush-headingFive" data-bs-parent="#qa-accordion">
            <p class="
                      accordion-body
                      mb-0
                      pe-3
                      fs-lg-sm fs-mobile-4
                      lh-lg
                      text-secondary
                    ">
              当店のシェフは豊富な経験と専門知識を持つプロフェッショナルです。熟練した料理人がお客様に最高の食体験を提供するために、日々努力しています。
            </p>
          </div>
        </li>
        <li class="accordion-item">
          <h3 class="accordion-header" id="flush-headingSix">
            <button class="
                      accordion-button
                      btn-outline-warning
                      collapsed
                      fs-lg-sm fs-mobile-4
                    " type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseSix" aria-expanded="false" aria-controls="flush-collapseSix">
              <span class="
                        bg-warning
                        text-dark
                        font-baloo-tamma
                        fw-bolder
                        text-center
                        rounded
                        fs-sm
                        me-3
                        lh-lg
                        letter-spacing-7
                      ">
                Q6
              </span>
              レビューに対するコメントはオーナーのみが投稿することができますか？
            </button>
          </h3>
          <div id="flush-collapseSix" class="accordion-collapse collapse" aria-labelledby="flush-headingSix" data-bs-parent="#qa-accordion">
            <p class="
                      accordion-body
                      mb-0
                      pe-3
                      fs-lg-sm fs-mobile-4
                      lh-lg
                      text-secondary
                    ">
              はい、レビューに対するコメントはオーナーのみが投稿することができます。お客様からの貴重な意見やフィードバックに対して、オーナーが返信や感謝のメッセージを送ることができます。当店では、お客様の満足度向上とより良いサービス提供のために、皆様のご意見に真摯に対応しています。どうもありがとうございます。
            </p>
          </div>
        </li>
      </ul>
    </div>
    

    <!-- tab - review-tab -->
    <div class="tab-pane active show review-tab" id="tab-comment" role="tabpanel">
      <div class="
                border-3
                rounded
                border-start border-warning
                p-3
                text-dark
                mb-3
                d-none d-md-block
                letter-spacing-7
                bg-gray-100
              ">
        レビューを書いた方には<a href="#" class="link-danger">ポイント50Pを積立します！</a>
      </div>
      <ul class="mb-4 list-unstyled">
        

        
        <li class="mb-3" v-for="(content, index) in props" :key="index">
          <div class="border rounded-4 p-3 comment">
            <div class="d-flex justify-content-start" id="review-header">

              <div class="review-title">
          <div class="img-wrap">
            <v-img
            class="bg-white"
            width="5vw"
            :aspect-ratio="1"
            :src="getThumbUrl(content.review.userThumb)"
          ></v-img>
          </div>
              <!-- <img src="https://ns-union.s3.ap-northeast-2.amazonaws.com/guruguru/ae74e661-de6e-4c84-8393-3cb192df9c72839af70d-5b78-412a-a595-dd469956ebb91157109.png" /> -->
              <div class="d-flex flex-column align-items-start ms-3">
                <v-rating
                              class="my-rating"
                              v-model="content.review.reviewRating"
                              readonly
                              density="compact"
                              bg-color="orange-lighten-1"
                              id="t"
                ></v-rating>

                
                <!-- <a href="#" class="
                          fs-lg-5 fs-mobile-4
                          link-gray-700
                          letter-spacing-20
                        ">{{ content.review.userNick }}</a> -->
                <a href="#" class="
                          letter-spacing-20
                          fs-lg-5 fs-mobile-4
                          link-gray-700
                        ">
                  {{ content.review.userNick }}
                </a>
                <small class="text-secondary fs-sm letter-spacing-20">
                  {{ content.review.createdAt[0] }}年{{ content.review.createdAt[1] }}月{{ content.review.createdAt[2] }}日
                  {{ content.review.createdAt[3] < 10 ? '0'+ content.review.createdAt[3] : content.review.createdAt[3] }}:{{ content.review.createdAt[4] < 10 ? '0' + content.review.createdAt[4] : content.review.createdAt[4] }}
                </small>
              </div>
              </div>

              <div class="edit-wrap" v-show="$store.state.uid === content.review.userId">
                <div @click="showUpdateReviewForm()">
                  <v-chip
                  class="ma-2 ed"
                  variant="outlined"
                  >
                  <svg-icon type="mdi" :path="editIcon"></svg-icon>
                  <span class="dl-text">修正</span>
                  </v-chip>
                </div>
                <div @click="deleteReply(content.review, content.reply)">
                  <v-chip
                  class="ma-2 dl "
                  variant="outlined"
                  >
                  <svg-icon type="mdi" :path="path"></svg-icon>
                  <span class="dl-text">削除</span>
                  </v-chip>
                </div>
              </div>
            </div>
            <div>
              <p class="text-gray-800 my-3 letter-spacing-7">
                {{ content.review.reviewText }}
              </p>
            </div>
            <div v-show="content.reply == null">
              <span class="reply
                    fw-bold
                    fs-sm letter-spacing-10
                    d-block
                    "
                    @click="showCommentForm()"
                >コメント</span>
            </div>
            <div class="
                      text-gray-800
                      p-3
                      bg-light
                      rounded-2
                      letter-spacing-7
                    "
                    v-if="isShowCommnentForm || isShowUpdateReviewForm"
            >
              <!-- コメントフォーム -->
              <div class="mb-3" v-show="isShowCommnentForm">
                <v-container fluid>
                  <v-textarea
                    name="input-7-1"
                    variant="filled"
                    clearable
                    v-model="replyText"
                    placeholder="お客さまへのコメントを作成してください。"
                    required
                    model-value="The Woodman set to work at once, and so sharp was his axe that the tree was soon chopped nearly through."
                  ></v-textarea>
                  <div class="replyBtn">
                    <button class="
                          btn
                          btn-sm
                          btn-outline-secondary
                          btn-outline-secondary-hover
                          rounded-pill
                          px-3
                          "
                        @click="saveReply(content.review.rid)"
                    >
                      <i class="far fa-comment-dots me-2 text-secondary"></i>コメント
                    </button>
                  </div>
                </v-container>
                <div class="invalid-feedback">請選擇一種付款方式</div>
              </div>

              <!-- レビュー修正フォーム -->
              <div class="mb-3" v-show="isShowUpdateReviewForm">
                <v-container fluid>
                  <v-textarea
                    name="input-7-1"
                    variant="filled"
                    clearable
                    v-model="reviewUpdateText"
                    placeholder="変更するレビューを書いてください。"
                    required
                    model-value=""
                  ></v-textarea>
                  <div class="replyBtn">
                    <button class="
                          btn
                          btn-sm
                          btn-outline-secondary
                          btn-outline-secondary-hover
                          rounded-pill
                          px-3
                          "
                        @click="editReview(content.review.rid)"
                    >
                      <i class="far fa-comment-dots me-2 text-secondary"></i>レビュー修正
                    </button>
                  </div>
                </v-container>
                <div class="invalid-feedback">請選擇一種付款方式</div>
              </div>
            </div>
            <div class="reply-content" v-if="content.reply !== null">
              <span class="
                  text-danger
                  w-100
                  fs-sm
                  d-block
                  mb-2
                  letter-spacing-6
              ">オーナー</span>
              {{ content.reply.replyText }} 
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>
</template>

<script>
import SvgIcon from '@jamescoyle/vue-icon'
import { mdiDeleteVariant, mdiPencil } from '@mdi/js';

export default {
  computed: {
    
  },
  components: {
    SvgIcon
  },
  props: ['props'],
  data() {
    return {
      isShowCommnentForm: false,
      isShowUpdateReviewForm: false,
      replyText: null,
      mdiDelete: true,
      path: mdiDeleteVariant,
      editIcon: mdiPencil,
      reviewUpdateText: null
    }
  },
  methods: {
    showCommentForm() {
      this.isShowCommnentForm = !this.isShowCommnentForm;
    },
    saveReply(reviewId) {
      const reply = {
        replyText: this.replyText,
        reviewId: reviewId
      }
      this.$emit('addReply', reply);
      this.showCommentForm();
    },
    deleteReply(reviewParam, replyParam) {
      let reviewObject = null;
      if(replyParam) {
        reviewObject = {
          reviewId: reviewParam.rid,
          replyId: replyParam.replyId
        }
      }
      else {
        reviewObject = {
          reviewId: reviewParam.rid,
          replyId: null
        }
      }
      console.log(reviewObject);
      this.$emit('deleteReply', reviewObject);
    },
    showUpdateReviewForm() {
      this.isShowUpdateReviewForm = !this.isShowUpdateReviewForm;
    },
    editReview(reviewId) {
      if(!this.reviewUpdateText) {
        alert('レビューを作成してください。');
        return;
      }
      const review = {
        reviewId: reviewId,
        reviewText: this.reviewUpdateText
      }
      this.$emit('editReview', review);
      this.showUpdateReviewForm();
    },
    getThumbUrl(url) {
      return "https://ns-union.s3.ap-northeast-2.amazonaws.com/guruguru/" + url;
    },
    
  }
  
}
</script>

<style scoped>
.my-rating >>> .theme--light.v-icon {
  color: #FFD700;
  padding: 0;
  position: relative;
  right: 0.3vw
}
.reply {
  color: #636057;
  text-decoration: none;  
  position: relative;
}
.reply:hover{
  color: #ff785e;
  cursor: pointer;
}
#review-header {
    justify-content: space-between !important;
}
.review-title {
  display: flex;
}
.theme--light.v-chip:not(.v-chip--active) {
  background: transparent;
  border: solid 1px #e91e63;
}
.dl {
  color: #e91e63!important;
  cursor: pointer;
}
.ed {
  color: #009688;
  cursor: pointer;
  border: solid 1px #009688 !important;
}
.dl-text {
  margin-left: 5px;
}
.replyBtn {
  display: flex;
  justify-content: flex-end;
}
.edit-wrap {
  display: flex;
  flex-direction: row;
  gap: 1vh
}
.review-tab {
  position: relative;
  bottom: 50px;
}

.img-wrap {
  /* display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center; */
}
</style>